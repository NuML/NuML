#
# @configure_input@
#
# (NOTES)
#
# Firstly, libnuml.spec needs to be generated by running configure script.
# By default, libxml2 is used for building libNUML.
# To use expat or xerces instead of libxml2, run the configure script as follows:
#
#  (expat)  % ./configure --with-expat 
#  (xerces) % ./configure --with-xerces
#
# If you want to use Doxygen and/or SWIG which is not installed in system path
# (i.e., not installed in /usr ), then add --with-doxygen=/path/to/doxygen and/or 
# --with-swig=/path/to/swig when running the configure script.
#
# To create libNUML RPM packages, run rpmbuild command as follows:
# (libnuml-@PACKAGE_VERSION@-src.zip needs to be located in SOURCES directory of your 
#  RPM working directory.)
#
#  % rpmbuild -ba libnuml.spec
#
# To create RPM packages of each language bindings, add the following --with XXXX 
# options when running rpmbuild command:
# 
#  (Java)   --with java
#  (C#)     --with csharp
#  (Python) --with python
#  (Ruby)   --with ruby
#  (Perl)   --with perl
#  (Octave) --with octave
#
# For example, the following command will create all subpackages:
#
#  % rpmbuild -ba libnuml.spec --with java --with csharp --with python --with ruby \
#             --with perl --with octave
#

%define xmlparser  @XML_PARSER@
%define @XML_PARSER@ 1
%define name       libnuml-%{xmlparser}
%define major_version    @LIBNUML_MAJOR_VERSION@
%define minor_version    @LIBNUML_MINOR_VERSION@
%define revision_version @LIBNUML_REVISION_VERSION@
%define version          %{major_version}.%{minor_version}.%{revision_version}
%define package_version  @PACKAGE_VERSION@
%define release    1
%if @LIBNUML_BETA_VERSION@0
%define release    0.@LIBNUML_BETA_VERSION@
%endif
%define docdir     doc/libnuml-%{package_version}

Summary: libNUML: An API Library for NUML
Name: %{name}
Version: %{version}
Release: %{release}
Group: Development/Libraries
Source: http://downloads.sourceforge.net/numl/libnuml-%{package_version}-src.zip
URL: http://numl.org/Software/libNUML
Packager: libNUML Team <dada@ieee.org>
License: LGPL
Prefix: /usr
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)

BuildRequires: check-devel >= 0.9.2
BuildRequires: zlib-devel, bzip2-devel
%{?expat:BuildRequires: expat-devel >= 1.95.8}
%{?libxml2:BuildRequires: libxml2-devel >= 2.6.16}
%{?xerces:BuildRequires: xerces-c-devel }
%{?_with_java:BuildRequires: jdk >= 1.5.0}
%{?_with_python:BuildRequires: python-devel}
%{?_with_ruby:BuildRequires: ruby-devel}
%{?_with_perl:BuildRequires: perl}
%{?_with_csharp:BuildRequires: mono-core}
%{?_with_octave:BuildRequires: octave-devel >= 2.9.7}

Requires: zlib
Requires: bzip2
%{?expat:Requires: expat >= 1.95.8}
%{?libxml2:Requires: libxml2 >= 2.6.16}
%{?xerces:Requires: xerces-c }

%{!?expat:Conflicts: libnuml-expat}
%{!?libxml2:Conflicts: libnuml-libxml2}
%{!?xerces:Conflicts: libnuml-xerces}

########SBML library
#%{?libsbml:Requires: libsbml >= 4.0.1}


%description
LibNUML is an open-source programming library designed to help you 
read, write, manipulate, translate, and validate NUML files and data 
streams. It is not an application itself (though it does come with 
example programs), but rather a library you can embed in your own 
applications.
LibNUML %{version} understands NUML Level 2 Version 4 or before, 
as well as the draft NUML Layout proposal by Gauges, Rost, Sahle and 
Wegner. It's written in ISO C and C++ but can also be used from Java, 
Python, Perl, Ruby, and Octave.

###########################################################################

%package devel
Summary: Libraries and header files to develop applications using libNUML
Group: Development/Libraries
Requires: %{name} = %{version}-%{release}
%{!?expat:Conflicts: libnuml-expat-devel}
%{!?libxml2:Conflicts: libnuml-libxml2-devel}
%{!?xerces:Conflicts: libnuml-xerces-devel}

%{!?libsbml:Conflicts: libnuml-libsbml-devel}

%description devel
The %{name}-devel package contains the libraries, include files and 
documentation to develop applications with libNUML.

###########################################################################

%package java
Summary: Libraries to develop applications using libNUML Java binding
Group: Development/Libraries
Requires: %{name} = %{version}-%{release}
Requires: jdk >= 1.5.0
%{!?expat:Conflicts: libnuml-expat-java}
%{!?libxml2:Conflicts: libnuml-libxml2-java}
%{!?xerces:Conflicts: libnuml-xerces-java}

%description java
The %{name}-java package contains the libraries to develop applications with 
libNUML Java bindings.

###########################################################################

%package csharp
Summary: Libraries to develop applications using libNUML C# binding
Group: Development/Libraries
Requires: %{name} = %{version}-%{release}
Requires: mono-core
%{!?expat:Conflicts: libnuml-expat-csharp}
%{!?libxml2:Conflicts: libnuml-libxml2-csharp}
%{!?xerces:Conflicts: libnuml-xerces-csharp}

%description csharp
The %{name}-csharp package contains the libraries to develop applications with 
libNUML C# bindings.

###########################################################################

%package python
Summary: Libraries to develop applications using libNUML Python binding
Group: Development/Libraries
Requires: %{name} = %{version}-%{release}
Requires: python
%{!?expat:Conflicts: libnuml-expat-python}
%{!?libxml2:Conflicts: libnuml-libxml2-python}
%{!?xerces:Conflicts: libnuml-xerces-python}

%description python
The %{name}-python package contains the libraries to develop applications with 
libNUML Python bindings.

###########################################################################

%package perl
Summary: Libraries to develop applications using libNUML Perl binding
Group: Development/Libraries
Requires: %{name} = %{version}-%{release}
Requires: perl
%{!?expat:Conflicts: libnuml-expat-perl}
%{!?libxml2:Conflicts: libnuml-libxml2-perl}
%{!?xerces:Conflicts: libnuml-xerces-perl}

%description perl
The %{name}-perl package contains the libraries to develop applications with 
libNUML Perl bindings.

###########################################################################

%package ruby
Summary: Libraries to develop applications using libNUML Ruby binding
Group: Development/Libraries
Requires: %{name} = %{version}-%{release}
Requires: ruby
%{!?expat:Conflicts: libnuml-expat-ruby}
%{!?libxml2:Conflicts: libnuml-libxml2-ruby}
%{!?xerces:Conflicts: libnuml-xerces-ruby}

%description ruby
The %{name}-ruby package contains the libraries to develop applications with 
libNUML Ruby bindings.

###########################################################################

%package octave 
Summary: Libraries to develop applications using libNUML Octave binding 
Group: Development/Libraries 
Requires: %{name}-devel = %{version}-%{release} 
Requires: octave >= 2.9.7 
%{!?expat:Conflicts: libnuml-expat-octave}
%{!?libxml2:Conflicts: libnuml-libxml2-octave}
%{!?xerces:Conflicts: libnuml-xerces-octave}

%description octave 
The %{name}-octave package contains the libraries to develop applications with 
libNUML Octave bindings.

###########################################################################

%prep
%setup -q -n libnuml-%{package_version}

%build
rm -rf $RPM_BUILD_ROOT
export CFLAGS="$RPM_OPT_FLAGS"
%configure --with-%{xmlparser} --with-libsbml --enable-layout --with-check --with-swig@SWIG_CONFIG_OPT@ \
     --with-doxygen@DOXYGEN_CONFIG_OPT@ %{?_with_java: --with-java} %{?_with_csharp: --with-csharp} \
     %{?_with_perl: --with-perl} %{?_with_ruby: --with-ruby} \
     %{?_with_python: --with-python} %{?_with_octave: --with-octave}
make 
make check
make docs
NUML
%install
rm -rf ${RPM_BUILD_ROOT}

make install DESTDIR=$RPM_BUILD_ROOT
make install-docs DESTDIR=$RPM_BUILD_ROOT

%clean
rm -rf ${RPM_BUILD_ROOT}

%post   -p /sbin/ldconfig
%postun -p /sbin/ldconfig



%files
%defattr(-,root,root)
%doc AUTHORS.txt README.txt COPYING.txt NEWS.txt
%{_libdir}/libnuml.la
%{_libdir}/libnuml.so.1
%{_libdir}/libnuml.so.%{version}

%files devel
%defattr(-,root,root)
%{_datadir}/%{docdir}/cpp-api/*
%{_datadir}/%{docdir}/c-api/*
%{_libdir}/libnuml.so
%{_libdir}/libnuml.a
%{_includedir}/*
%{_libdir}/pkgconfig/libnuml.pc

%{?_with_java:%files java }
%{?_with_java:%{_datadir}/%{docdir}/java-api/* }
%{?_with_java:%{_libdir}/libnumlj.so }
%{?_with_java:%{_datadir}/java/libnumlj.jar} 

%{?_with_csharp:%files csharp }
%{?_with_csharp:%{_libdir}/mono/* }

%{?_with_python:%files python }
%{?_with_python:%{_datadir}/%{docdir}/python-api/* }
%{?_with_python:%{_libdir}/python*/* }

%{?_with_perl:%files perl }
%{?_with_perl:%{_datadir}/%{docdir}/perl-api/* }
%{?_with_perl:%{_libdir}/perl5/* }

%{?_with_ruby:%files ruby }
%{?_with_ruby:%{_libdir}/ruby/* }

%{?_with_octave:%files octave }
%{?_with_octave:%{_libexecdir}/octave/* }

%changelog

